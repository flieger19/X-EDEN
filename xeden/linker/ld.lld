#!/bin/zsh

arguments=""
filelist=""
dependency_info=""
is_filelist=false
is_no_deduplicate=false
is_dependency_info=false

for arg;
do
  if $is_filelist; then
    filelist=$arg
    is_filelist=false
  elif $is_no_deduplicate; then
    is_no_deduplicate=false
  elif $is_dependency_info; then
    dependency_info=$arg
    is_dependency_info=false
  elif [ "$arg" = "-filelist" ]; then
    is_filelist=true
  elif [ "$arg" = "-no_deduplicate" ]; then
    is_no_deduplicate=false
  elif [ "$arg" = "-dependency_info" ]; then
    is_dependency_info=true
  else
    arguments="$arguments $arg"
  fi
done

objects=""
directory=""
project_directory="$(pwd)"

while read line; do
    objects="$objects $(basename "$line")"
    directory="$(dirname "$line")"
done < "$filelist"

cd $directory
command="${HOME}/Library/Developer/Toolchains/X-EDEN.xctoolchain/usr/sbin/ld.lld $objects $arguments"
$command
exit_code=$?
cd $project_directory

exit $exit_code